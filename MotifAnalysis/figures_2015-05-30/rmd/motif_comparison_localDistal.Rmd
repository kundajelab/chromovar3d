
local.f='/srv/gsfs0/projects/snyder/oursu/histoneQTL/motif_analysis/results/2015-01-13/Local/LocalAnalysis_allMarks.gz'
distal.f='/srv/gsfs0/projects/snyder/oursu/histoneQTL/motif_analysis/results/2015-01-13/Local/DistalAnalysis_allMarks.gz'

local=read.table(local.f,header=TRUE)
distal=read.table(distal.f,header=TRUE)

distal=distal[order(abs(as.numeric(as.character(distal$spearmanCorr_MotifScoreVSpeak))),decreasing=T),]
local=local[order(abs(as.numeric(as.character(local$spearmanCorr_MotifScoreVSpeak))),decreasing=T),]
local.sig=local[which(as.numeric(as.character(local$genomeWide_match.p.sp))<=0.05),]
distal.sig=distal[which(as.numeric(as.character(distal$genomeWide_match.p.sp))<=0.05),]

length(intersect(unique(paste(local.sig$scoredRegionName,local.sig$motifName)),unique(paste(distal.sig$scoredRegionName,distal.sig$motifName))))
length(unique(paste(local.sig$scoredRegionName,local.sig$motifName)))
length(unique(paste(distal.sig$scoredRegionName,distal.sig$motifName)))

local.sig=local[which(as.numeric(as.character(local$site_p.sp))<=0),]
distal.sig=distal[which(as.numeric(as.character(distal$site_p.sp))<=0),]

length(intersect(unique(paste(local.sig$scoredRegionName,local.sig$motifName)),unique(paste(distal.sig$scoredRegionName,distal.sig$motifName))))
length(unique(paste(local.sig$scoredRegionName,local.sig$motifName)))
length(unique(paste(distal.sig$scoredRegionName,distal.sig$motifName)))

tfs=unique(as.character(distal$motifName))
pdf('/home/oursu/localDistalCorr_distalSig.pdf')
for (tf in tfs){

print(tf)
local.uniqRegions=local[-which(duplicated(local$scoredRegionName)),]
distal.uniqRegions=distal[-which(duplicated(distal$scoredRegionName)),]
rownames(local.uniqRegions)=local.uniqRegions$scoredRegionName
distal.uniqRegions=distal.uniqRegions[which(as.numeric(as.character(distal.uniqRegions$site_p.sp))<=0),]
local.uniqRegions=local.uniqRegions[which(as.character(local.uniqRegions$motifName)==tf),]
distal.uniqRegions=distal.uniqRegions[which(as.character(distal.uniqRegions$motifName)==tf),]

plot(as.numeric(as.character(distal.uniqRegions$spearmanCorr_MotifScoreVSpeak)),
	as.numeric(as.character(local.uniqRegions[as.character(distal.uniqRegions$scoredRegionName),'spearmanCorr_MotifScoreVSpeak'])),
	xlab='Distal correlation', ylab='local correlation',main=tf)
}
plot(as.numeric(as.character(distal.uniqRegions$genomeWide_match.p.sp)),
        as.numeric(as.character(local.uniqRegions[as.character(distal.uniqRegions$scoredRegionName),'genomeWide_match.p.sp'])),
        xlab='Distal genome-wide p', ylab='local genomewide p',main=tf)
}
dev.off()
